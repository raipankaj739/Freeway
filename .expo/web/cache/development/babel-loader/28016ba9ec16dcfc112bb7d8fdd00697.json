{"ast":null,"code":"// iOS 12.2 disables DeviceMotion by default now\n// https://github.com/w3c/deviceorientation/issues/57\nexport async function assertSensorEventEnabledAsync(eventName, timeout) {\n  const isEnabled = await isSensorEnabledAsync(eventName, timeout);\n\n  if (isEnabled) {\n    return true;\n  }\n\n  throw new Error(`Cannot observe event: ${eventName}.` + '\\nEnable device orientation in Settings > Safari > Motion & Orientation Access' + '\\nalso ensure that you are hosting with https as DeviceMotion is now a secure API on iOS Safari.');\n} // throw error if the sensor is disabled.\n\nexport async function isSensorEnabledAsync(eventName, // Initial interval tests found results on a median of\n// devicemotion:\n// - iPhone 7 Plus: 166.6666753590107ms\n// - iPhone X: 166.6666753590107ms\n// deviceorientation:\n// -\n//\n// The initial launch of iOS Safari onto a page calling this API seems to take a little longer than a regular call.\n// devicemotion:\n// - ~35ms\n// deviceorientation:\n// - ~45ms\n//\ntimeout = 250) {\n  if (!isIOS()) {\n    return true;\n  }\n\n  return new Promise(resolve => {\n    const id = setTimeout(() => {\n      window.removeEventListener(eventName, listener);\n      resolve(false);\n    }, timeout);\n\n    const listener = () => {\n      clearTimeout(id);\n      window.removeEventListener(eventName, listener);\n      resolve(true);\n    };\n\n    window.addEventListener(eventName, listener);\n  });\n} // https://stackoverflow.com/a/9039885/4047926\n\nfunction isIOS() {\n  const isIOSUA = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);\n  const isIE11 = !!window['MSStream'];\n  return isIOSUA && !isIE11;\n}","map":{"version":3,"sources":["../../src/utils/isSensorEnabledAsync.web.ts"],"names":[],"mappings":"AAEA;AACA;AACA,OAAO,eAAe,6BAAf,CACL,SADK,EAEL,OAFK,EAEW;AAEhB,QAAM,SAAS,GAAG,MAAM,oBAAoB,CAAC,SAAD,EAAY,OAAZ,CAA5C;;AACA,MAAI,SAAJ,EAAe;AACb,WAAO,IAAP;AACD;;AAED,QAAM,IAAI,KAAJ,CACJ,yBAAyB,SAAS,GAAlC,GACE,gFADF,GAEE,kGAHE,CAAN;AAKD,C,CAED;;AACA,OAAO,eAAe,oBAAf,CACL,SADK,EAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAA,GAAkB,GAfb,EAegB;AAErB,MAAI,CAAC,KAAK,EAAV,EAAc;AACZ,WAAO,IAAP;AACD;;AAED,SAAO,IAAI,OAAJ,CAAY,OAAO,IAAG;AAC3B,UAAM,EAAE,GAAG,UAAU,CAAC,MAAK;AACzB,MAAA,MAAM,CAAC,mBAAP,CAA2B,SAA3B,EAAsC,QAAtC;AACA,MAAA,OAAO,CAAC,KAAD,CAAP;AACD,KAHoB,EAGlB,OAHkB,CAArB;;AAKA,UAAM,QAAQ,GAAG,MAAW;AAC1B,MAAA,YAAY,CAAC,EAAD,CAAZ;AACA,MAAA,MAAM,CAAC,mBAAP,CAA2B,SAA3B,EAAsC,QAAtC;AACA,MAAA,OAAO,CAAC,IAAD,CAAP;AACD,KAJD;;AAMA,IAAA,MAAM,CAAC,gBAAP,CAAwB,SAAxB,EAAmC,QAAnC;AACD,GAbM,CAAP;AAcD,C,CAED;;AACA,SAAS,KAAT,GAAc;AACZ,QAAM,OAAO,GAAG,sBAAsB,IAAtB,CAA2B,SAAS,CAAC,SAArC,CAAhB;AACA,QAAM,MAAM,GAAG,CAAC,CAAC,MAAM,CAAC,UAAD,CAAvB;AACA,SAAO,OAAO,IAAI,CAAC,MAAnB;AACD","sourcesContent":["type SensorEventName = 'deviceorientation' | 'devicemotion';\n\n// iOS 12.2 disables DeviceMotion by default now\n// https://github.com/w3c/deviceorientation/issues/57\nexport async function assertSensorEventEnabledAsync(\n  eventName: SensorEventName,\n  timeout?: number\n): Promise<boolean> {\n  const isEnabled = await isSensorEnabledAsync(eventName, timeout);\n  if (isEnabled) {\n    return true;\n  }\n\n  throw new Error(\n    `Cannot observe event: ${eventName}.` +\n      '\\nEnable device orientation in Settings > Safari > Motion & Orientation Access' +\n      '\\nalso ensure that you are hosting with https as DeviceMotion is now a secure API on iOS Safari.'\n  );\n}\n\n// throw error if the sensor is disabled.\nexport async function isSensorEnabledAsync(\n  eventName: SensorEventName,\n  // Initial interval tests found results on a median of\n  // devicemotion:\n  // - iPhone 7 Plus: 166.6666753590107ms\n  // - iPhone X: 166.6666753590107ms\n  // deviceorientation:\n  // -\n  //\n  // The initial launch of iOS Safari onto a page calling this API seems to take a little longer than a regular call.\n  // devicemotion:\n  // - ~35ms\n  // deviceorientation:\n  // - ~45ms\n  //\n  timeout: number = 250\n): Promise<boolean> {\n  if (!isIOS()) {\n    return true;\n  }\n\n  return new Promise(resolve => {\n    const id = setTimeout(() => {\n      window.removeEventListener(eventName, listener);\n      resolve(false);\n    }, timeout);\n\n    const listener = (): void => {\n      clearTimeout(id);\n      window.removeEventListener(eventName, listener);\n      resolve(true);\n    };\n\n    window.addEventListener(eventName, listener);\n  });\n}\n\n// https://stackoverflow.com/a/9039885/4047926\nfunction isIOS(): boolean {\n  const isIOSUA = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);\n  const isIE11 = !!window['MSStream'];\n  return isIOSUA && !isIE11;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}