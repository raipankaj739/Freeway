{"ast":null,"code":"import { UnavailabilityError } from '@unimodules/core';\nimport ExpoGoogleSignIn from './ExpoGoogleSignIn';\nimport GoogleAuthentication from './GoogleAuthentication';\nimport GoogleIdentity from './GoogleIdentity';\n\nclass GoogleUser extends GoogleIdentity {\n  constructor(options) {\n    super(options);\n\n    this.clearCache = async () => {\n      if (!ExpoGoogleSignIn.clearCacheAsync) {\n        return;\n      }\n\n      if (!this.auth || !this.auth.accessToken) {\n        throw new Error('GoogleSignIn: GoogleUser.clearCache(): Invalid accessToken');\n      }\n\n      return await ExpoGoogleSignIn.clearCacheAsync({\n        token: this.auth.accessToken\n      });\n    };\n\n    this.getHeaders = () => {\n      if (!this.auth || !this.auth.accessToken || !this.auth.accessToken.length) {\n        throw new Error('GoogleSignIn: GoogleUser.getHeaders(): Invalid accessToken');\n      }\n\n      return {\n        Authorization: `Bearer ${this.auth.accessToken}`,\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      };\n    };\n\n    this.refreshAuth = async () => {\n      if (!ExpoGoogleSignIn.getTokensAsync) {\n        throw new UnavailabilityError('GoogleSignIn', 'getTokensAsync');\n      }\n\n      const response = await ExpoGoogleSignIn.getTokensAsync(false);\n\n      if (response.idToken == null && this.auth) {\n        response.idToken = this.auth.idToken;\n      }\n\n      if (!this.auth) {\n        this.auth = new GoogleAuthentication(response);\n      } else {\n        this.auth.idToken = response.idToken;\n        this.auth.accessToken = response.accessToken;\n      }\n\n      return this.auth;\n    };\n\n    const {\n      auth,\n      scopes,\n      hostedDomain,\n      serverAuthCode\n    } = options;\n    this.auth = auth;\n    this.scopes = scopes;\n    this.hostedDomain = hostedDomain;\n    this.serverAuthCode = serverAuthCode;\n  }\n\n  equals(other) {\n    if (!super.equals(other) || !(other instanceof GoogleUser)) {\n      return false;\n    }\n\n    if (this.auth != null) {\n      return this.auth.equals(other.auth) && this.scopes === other.scopes && this.hostedDomain === other.hostedDomain && this.serverAuthCode === other.serverAuthCode;\n    } else {\n      return other.auth == null;\n    }\n  }\n\n  toJSON() {\n    let auth = this.auth;\n\n    if (this.auth && this.auth.toJSON) {\n      auth = this.auth.toJSON();\n    }\n\n    return { ...super.toJSON(),\n      auth,\n      scopes: this.scopes,\n      hostedDomain: this.hostedDomain,\n      serverAuthCode: this.serverAuthCode\n    };\n  }\n\n}\n\nexport default GoogleUser;","map":{"version":3,"sources":["../src/GoogleUser.ts"],"names":[],"mappings":"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","sourcesContent":["import { UnavailabilityError } from '@unimodules/core';\nimport invariant from 'invariant';\n\nimport ExpoGoogleSignIn from './ExpoGoogleSignIn';\nimport GoogleAuthentication from './GoogleAuthentication';\nimport GoogleIdentity from './GoogleIdentity';\n\nclass GoogleUser extends GoogleIdentity {\n  auth: GoogleAuthentication | null;\n  scopes: string[];\n  hostedDomain?: string;\n  serverAuthCode?: string;\n\n  constructor(options) {\n    super(options);\n    const { auth, scopes, hostedDomain, serverAuthCode } = options;\n\n    this.auth = auth;\n    this.scopes = scopes;\n    this.hostedDomain = hostedDomain;\n    this.serverAuthCode = serverAuthCode;\n  }\n\n  clearCache = async () => {\n    if (!ExpoGoogleSignIn.clearCacheAsync) {\n      return;\n    }\n    if (!this.auth || !this.auth.accessToken) {\n      throw new Error('GoogleSignIn: GoogleUser.clearCache(): Invalid accessToken');\n    }\n    return await ExpoGoogleSignIn.clearCacheAsync({ token: this.auth.accessToken });\n  };\n\n  getHeaders = (): {\n    [key: string]: string;\n  } => {\n    if (!this.auth || !this.auth.accessToken || !this.auth.accessToken.length) {\n      throw new Error('GoogleSignIn: GoogleUser.getHeaders(): Invalid accessToken');\n    }\n    return {\n      Authorization: `Bearer ${this.auth.accessToken}`,\n      Accept: 'application/json',\n      'Content-Type': 'application/json',\n    };\n  };\n\n  refreshAuth = async (): Promise<GoogleAuthentication | null> => {\n    if (!ExpoGoogleSignIn.getTokensAsync) {\n      throw new UnavailabilityError('GoogleSignIn', 'getTokensAsync');\n    }\n    const response: {\n      idToken?: string;\n      accessToken?: string;\n      auth?: {\n        accessToken?: string;\n      };\n    } = await ExpoGoogleSignIn.getTokensAsync(false);\n    if (response.idToken == null && this.auth) {\n      response.idToken = this.auth.idToken;\n    }\n    if (!this.auth) {\n      this.auth = new GoogleAuthentication(response);\n    } else {\n      this.auth.idToken = response.idToken;\n      this.auth.accessToken = response.accessToken;\n    }\n    return this.auth;\n  };\n\n  equals(other: any): boolean {\n    if (!super.equals(other) || !(other instanceof GoogleUser)) {\n      return false;\n    }\n\n    if (this.auth != null) {\n      return (\n        this.auth.equals(other.auth) &&\n        this.scopes === other.scopes &&\n        this.hostedDomain === other.hostedDomain &&\n        this.serverAuthCode === other.serverAuthCode\n      );\n    } else {\n      return other.auth == null;\n    }\n  }\n\n  toJSON(): { [key: string]: any } {\n    let auth: any = this.auth;\n    if (this.auth && this.auth.toJSON) {\n      auth = this.auth.toJSON();\n    }\n\n    return {\n      ...super.toJSON(),\n      auth,\n      scopes: this.scopes,\n      hostedDomain: this.hostedDomain,\n      serverAuthCode: this.serverAuthCode,\n    };\n  }\n}\n\nexport default GoogleUser;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}