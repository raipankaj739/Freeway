{"ast":null,"code":"import Constants from 'expo-constants';\nimport { UnavailabilityError } from '@unimodules/core';\nimport invariant from 'invariant';\nimport ExpoGoogleSignIn from './ExpoGoogleSignIn';\nimport GoogleUser from './GoogleUser';\nexport const {\n  ERRORS,\n  SCOPES,\n  TYPES\n} = ExpoGoogleSignIn;\nconst DEFAULT_SCOPES = [SCOPES.PROFILE, SCOPES.EMAIL];\n\nlet _initialization;\n\nlet _options;\n\nlet _currentUser = null;\nlet _isClientUsageEnabled = false;\n\nfunction setCurrentUser(currentUser) {\n  _currentUser = currentUser;\n  return _currentUser;\n}\n\nfunction validateOptions(options) {\n  if (!options) {\n    return {\n      scopes: DEFAULT_SCOPES\n    };\n  }\n\n  if (options.isOfflineEnabled) {\n    invariant(typeof options.webClientId === 'string' && options.webClientId !== '', 'GoogleSignIn: Offline access (isOfflineEnabled: true) requires a valid google server id `webClientId`');\n  }\n\n  return { ...options,\n    scopes: options.scopes || DEFAULT_SCOPES\n  };\n}\n\nfunction validateOwnership() {\n  invariant(_isClientUsageEnabled || Constants.appOwnership !== 'expo', 'expo-google-sign-in is not supported in the Expo Client because a custom URL scheme is required at build time. Please refer to the docs for usage outside of Expo www.npmjs.com/package/expo-google-sign-in');\n}\n\nasync function ensureGoogleIsInitializedAsync(options) {\n  if (_initialization == null) {\n    return initAsync(options);\n  }\n\n  return _initialization;\n}\n\nasync function invokeAuthMethod(method) {\n  if (!ExpoGoogleSignIn[method]) {\n    throw new UnavailabilityError('GoogleSignIn', method);\n  }\n\n  await ensureGoogleIsInitializedAsync();\n  const payload = await ExpoGoogleSignIn[method]();\n  let account = payload != null ? new GoogleUser(payload) : null;\n  return setCurrentUser(account);\n}\n\nexport function allowInClient() {\n  _isClientUsageEnabled = true;\n}\nexport function getCurrentUser() {\n  return _currentUser;\n}\nexport async function askForPlayServicesAsync() {\n  return await getPlayServiceAvailability(true);\n}\nexport async function getPlayServiceAvailability(shouldAsk = false) {\n  validateOwnership();\n\n  if (ExpoGoogleSignIn.arePlayServicesAvailableAsync) {\n    return await ExpoGoogleSignIn.arePlayServicesAvailableAsync(shouldAsk);\n  } else {\n    return true;\n  }\n}\nexport async function initAsync(options) {\n  if (!ExpoGoogleSignIn.initAsync) {\n    throw new UnavailabilityError('GoogleSignIn', 'initAsync');\n  }\n\n  _options = validateOptions(options || _options || {});\n  const hasPlayServices = await getPlayServiceAvailability();\n\n  if (!hasPlayServices) {\n    return;\n  }\n\n  _initialization = ExpoGoogleSignIn.initAsync(_options || {});\n  return _initialization;\n}\nexport async function isSignedInAsync() {\n  const user = await getCurrentUserAsync();\n  return user != null;\n}\nexport async function isConnectedAsync() {\n  return await ExpoGoogleSignIn.isConnectedAsync();\n}\nexport async function signInSilentlyAsync() {\n  const isConnected = await isConnectedAsync();\n\n  if (isConnected) {\n    try {\n      const auth = await invokeAuthMethod('signInSilentlyAsync');\n      return auth;\n    } catch (error) {\n      /* Return null to create parity with Android */\n      if (error.code === ERRORS.SIGN_IN_REQUIRED) {\n        return null;\n      }\n\n      throw error;\n    }\n  }\n\n  return null;\n}\nexport async function signInAsync() {\n  try {\n    const user = await invokeAuthMethod('signInAsync');\n    return {\n      type: 'success',\n      user\n    };\n  } catch (error) {\n    if (error.code === ERRORS.SIGN_IN_CANCELLED) {\n      return {\n        type: 'cancel',\n        user: null\n      };\n    }\n\n    throw error;\n  }\n}\nexport async function signOutAsync() {\n  await invokeAuthMethod('signOutAsync');\n}\nexport async function disconnectAsync() {\n  await invokeAuthMethod('disconnectAsync');\n}\nexport async function getCurrentUserAsync() {\n  return await invokeAuthMethod('getCurrentUserAsync');\n}\nexport async function getPhotoAsync(size = 128) {\n  if (!ExpoGoogleSignIn.getPhotoAsync) {\n    throw new UnavailabilityError('GoogleSignIn', 'getPhotoAsync');\n  }\n\n  await ensureGoogleIsInitializedAsync();\n  return await ExpoGoogleSignIn.getPhotoAsync(size);\n}\nexport { default as GoogleAuthData } from './GoogleAuthData';\nexport { default as GoogleAuthentication } from './GoogleAuthentication';\nexport { default as GoogleIdentity } from './GoogleIdentity';\nexport { default as GoogleUser } from './GoogleUser';","map":{"version":3,"sources":["../src/GoogleSignIn.ts"],"names":[],"mappings":"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","sourcesContent":["import Constants from 'expo-constants';\nimport { UnavailabilityError } from '@unimodules/core';\nimport invariant from 'invariant';\n\nimport ExpoGoogleSignIn from './ExpoGoogleSignIn';\nimport GoogleUser from './GoogleUser';\n\nimport { GoogleSignInOptions, GoogleSignInAuthResult } from './GoogleSignIn.types';\n\nexport const { ERRORS, SCOPES, TYPES } = ExpoGoogleSignIn;\n\nconst DEFAULT_SCOPES = [SCOPES.PROFILE, SCOPES.EMAIL];\n\nlet _initialization: Promise<void>;\nlet _options: GoogleSignInOptions;\nlet _currentUser: GoogleUser | null = null;\nlet _isClientUsageEnabled = false;\n\nfunction setCurrentUser(currentUser: GoogleUser | null): GoogleUser | null {\n  _currentUser = currentUser;\n  return _currentUser;\n}\n\nfunction validateOptions(options?: GoogleSignInOptions): GoogleSignInOptions {\n  if (!options) {\n    return {\n      scopes: DEFAULT_SCOPES,\n    };\n  }\n  if (options.isOfflineEnabled) {\n    invariant(\n      typeof options.webClientId === 'string' && options.webClientId !== '',\n      'GoogleSignIn: Offline access (isOfflineEnabled: true) requires a valid google server id `webClientId`'\n    );\n  }\n\n  return {\n    ...options,\n    scopes: options.scopes || DEFAULT_SCOPES,\n  };\n}\n\nfunction validateOwnership() {\n  invariant(\n    _isClientUsageEnabled || Constants.appOwnership !== 'expo',\n    'expo-google-sign-in is not supported in the Expo Client because a custom URL scheme is required at build time. Please refer to the docs for usage outside of Expo www.npmjs.com/package/expo-google-sign-in'\n  );\n}\n\nasync function ensureGoogleIsInitializedAsync(options?: GoogleSignInOptions): Promise<any> {\n  if (_initialization == null) {\n    return initAsync(options);\n  }\n  return _initialization;\n}\n\nasync function invokeAuthMethod(method: string): Promise<GoogleUser | null> {\n  if (!ExpoGoogleSignIn[method]) {\n    throw new UnavailabilityError('GoogleSignIn', method);\n  }\n  await ensureGoogleIsInitializedAsync();\n  const payload = await ExpoGoogleSignIn[method]();\n  let account = payload != null ? new GoogleUser(payload) : null;\n  return setCurrentUser(account);\n}\n\nexport function allowInClient() {\n  _isClientUsageEnabled = true;\n}\n\nexport function getCurrentUser(): GoogleUser | null {\n  return _currentUser;\n}\n\nexport async function askForPlayServicesAsync(): Promise<boolean> {\n  return await getPlayServiceAvailability(true);\n}\n\nexport async function getPlayServiceAvailability(shouldAsk: boolean = false): Promise<boolean> {\n  validateOwnership();\n\n  if (ExpoGoogleSignIn.arePlayServicesAvailableAsync) {\n    return await ExpoGoogleSignIn.arePlayServicesAvailableAsync(shouldAsk);\n  } else {\n    return true;\n  }\n}\n\nexport async function initAsync(options?: GoogleSignInOptions): Promise<void> {\n  if (!ExpoGoogleSignIn.initAsync) {\n    throw new UnavailabilityError('GoogleSignIn', 'initAsync');\n  }\n\n  _options = validateOptions(options || _options || {});\n\n  const hasPlayServices = await getPlayServiceAvailability();\n  if (!hasPlayServices) {\n    return;\n  }\n\n  _initialization = ExpoGoogleSignIn.initAsync(_options || {});\n\n  return _initialization;\n}\n\nexport async function isSignedInAsync(): Promise<boolean> {\n  const user = await getCurrentUserAsync();\n  return user != null;\n}\n\nexport async function isConnectedAsync(): Promise<boolean> {\n  return await ExpoGoogleSignIn.isConnectedAsync();\n}\n\nexport async function signInSilentlyAsync(): Promise<GoogleUser | null> {\n  const isConnected = await isConnectedAsync();\n  if (isConnected) {\n    try {\n      const auth = await invokeAuthMethod('signInSilentlyAsync');\n      return auth;\n    } catch (error) {\n      /* Return null to create parity with Android */\n      if (error.code === ERRORS.SIGN_IN_REQUIRED) {\n        return null;\n      }\n      throw error;\n    }\n  }\n  return null;\n}\n\nexport async function signInAsync(): Promise<GoogleSignInAuthResult> {\n  try {\n    const user = await invokeAuthMethod('signInAsync');\n    return { type: 'success', user };\n  } catch (error) {\n    if (error.code === ERRORS.SIGN_IN_CANCELLED) {\n      return { type: 'cancel', user: null };\n    }\n    throw error;\n  }\n}\n\nexport async function signOutAsync(): Promise<void> {\n  await invokeAuthMethod('signOutAsync');\n}\n\nexport async function disconnectAsync(): Promise<void> {\n  await invokeAuthMethod('disconnectAsync');\n}\n\nexport async function getCurrentUserAsync(): Promise<GoogleUser | null> {\n  return await invokeAuthMethod('getCurrentUserAsync');\n}\n\nexport async function getPhotoAsync(size: number = 128): Promise<string | null> {\n  if (!ExpoGoogleSignIn.getPhotoAsync) {\n    throw new UnavailabilityError('GoogleSignIn', 'getPhotoAsync');\n  }\n\n  await ensureGoogleIsInitializedAsync();\n  return await ExpoGoogleSignIn.getPhotoAsync(size);\n}\n\nexport { default as GoogleAuthData } from './GoogleAuthData';\nexport { default as GoogleAuthentication } from './GoogleAuthentication';\nexport { default as GoogleIdentity } from './GoogleIdentity';\nexport { default as GoogleUser } from './GoogleUser';\n\nexport {\n  GoogleSignInType,\n  GoogleSignInOptions,\n  GoogleSignInAuthResultType,\n  GoogleSignInAuthResult,\n} from './GoogleSignIn.types';\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}